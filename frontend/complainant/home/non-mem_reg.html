<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="/images/logo.png">
  <title>ReklaMap</title>
  <link rel="stylesheet" href="/css/complainants.css">
</head>
<body>

  <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo-section">
        <img src="/images/logo.png" alt="ReklaMap Logo" class="logo">
        <span class="title"><span class="blue-text">Rekla</span><span class="green-text">Map</span></span>
        </div>
        <nav class="nav-menu">
        <a href="/complainant/home/dashboard.html" class="nav-item active">Home</a>
        <a href="/complainant/complaints/submitted_complaints.html" class="nav-item">Complaints</a>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main">
      <article class="card" role="main">
      <h1 id="page-title" class="page-title">Non-HOA Member Registration</h1>

      <!-- TOP: registrant basic fields -->
      <form id="memRegForm" enctype="multipart/form-data" autocomplete="off" novalidate>
        <div class="form-grid" aria-hidden="false">
          <label>Last Name<input type="text" name="reg_last"></label>
          <label>First Name<input type="text" name="reg_first"></label>
          <label>Middle Name<input type="text" name="reg_mid"></label>
          <label>Suffix
            <select name="reg_suffix">
              <option value="" disabled selected hidden></option>
              <option>NA</option>
              <option>Sr.</option>
              <option>Jr.</option>
            </select>
          </label>

          <label>Date of Birth<input type="date" name="reg_dob"></label>
          <label>Sex
            <select name="reg_sex">
              <option value="" disabled selected hidden></option>
              <option>Male</option><option>Female</option>
            </select>
          </label>
          <label>Citizenship<input type="text" name="reg_cit"></label>
          <label>Age<input type="number" name="reg_age" min="0" step="1"></label>
        </div>

        <div class="form-grid" aria-hidden="false">
            <label>Phone Number<input type="text" name="reg_num"></label>
            <label>Year of Residence<input type="text" name="reg_year"></label>
            <label>Current Address<input type="text" name="reg_cur_add"></label>
            
            <!-- Civil status column (right) -->
        <aside class="civil-status">
            <div class="label">Civil Status:</div>
            <div class="civil-grid">
                <label><input type="radio" name="fam_civil" value="single"> Single</label>
                <label><input type="radio" name="fam_civil" value="widowed"> Widowed</label>
                <label><input type="radio" name="fam_civil" value="married"> Married</label>
                <label><input type="radio" name="fam_civil" value="separated"> Separated</label>
                <label><input type="radio" name="fam_civil" value="divorced"> Divorced</label>
                <label><input type="radio" name="fam_civil" value="annulled"> Annulled</label>
            </div>
        </aside>
        </div>

         <!-- separator -->
        <div class="separator" aria-hidden="true"></div>

        <!-- radio question (one option per row) -->
        <div class="radio-section" role="group">
          <p id="recipient-label">Recipient of other housing programs besides NGCCHP ?</p>
          <div class="radio-list">
            <label><input type="radio" name="recipient" value="yes"> Yes</label>
            <label><input type="radio" name="recipient" value="no"> No</label>
          </div>
        </div>

        <!-- complaint about questions -->
        <p style="font-weight:700; margin-bottom:10px; color: #001241; font-size: 14px;margin-top: 20px;">
          Please indicate the specific lot you are filing a complaint about:
        </p>
        <div class="form-grid" aria-hidden="false" style="grid-template-columns: repeat(3, 1fr);">
           <label>HOA
              <select name="reg_hoa" required>
                  <option value="" disabled selected hidden></option>
                  {% for area in areas %}
                    <option value="{{ area.area_id }}">{{ area.area_name }}</option>
                  {% endfor %}
              </select>
            </label>
            <label>Lot Address<input type="text" name="reg_lot_add"></label>
            <label>Lot Size<input type="text" name="reg_lot_size"></label>            
        </div>

        <!-- supporting documents (stacked) -->
        <div class="support-docs" role="group">
          <p id="docs-label">How are you connected to the lot you are complaining about??</p>
          <div class="docs-list">
            <label><input type="checkbox" > I live on the lot but I am not the official beneficiary</label>
            <label><input type="checkbox" > I live near the lot and I am affected by the issue</label>
            <label><input type="checkbox" > I am claiming ownership of the lot</label>
            <label><input type="checkbox" > I am related to the person currently occupying the lot</label>
            <label><input type="checkbox" > I was previously assigned to this lot but was replaced or removed</label>
            <label>
            <label><input type="checkbox" id="otherCheck"> Other:</label>
            <input type="text" id="otherText" style="display:none; border:none; border-bottom:1px solid #000; outline:none; width:400px;">
          </div>
        </div>

        <!-- upload signature + disclaimer -->
        <div class="upload-section">
          <p class="disclaimer">
            This signature will serve as your official compliance item. It confirms that the
            information you provided is accurate to the best of your knowledge and that you agree to
            the terms of the submission process. Make sure your signature is legible and matches
            your registered name. 
          </p>

          <!-- Hidden category input -->
          <input type="hidden" name="category" value="{{ category }}">

          <!-- Hidden file input -->
          <input type="file" id="signatureInput" name="signature" accept="image/*" style="display:none;" />

          <!-- Upload button -->
          <button type="button" class="upload-btn" onclick="document.getElementById('signatureInput').click()">Upload Signature</button>

          <!-- File name preview -->
          <span id="signatureFileName" style="margin-left:10px; font-style:italic;"></span>
        </div>

         <!-- actions -->
        <div class="actions">
          <button type="button" class="btn cancel" onclick="window.location.href='/complainant/home/not_registered.html'">Cancel</button>
          <button type="submit" class="btn submit">Submit</button>
        </div>
      </form>
  </main>

   <!-- Script for file input preview -->
    <script>
      const sigInput = document.getElementById("signatureInput");
      const sigFileName = document.getElementById("signatureFileName");

      sigInput.addEventListener("change", function () {
        if (this.files.length > 0) {
          sigFileName.textContent = "âœ” " + this.files[0].name;
        } else {
          sigFileName.textContent = "";
        }
      });
    </script>

    // Form submission via fetch
  <script>
    document.getElementById("memRegForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      const formData = new FormData(this);

      try {
        const response = await fetch("/complainant/nonmemreg", {
          method: "POST",
          body: formData,
          credentials: "same-origin"
        });

        const result = await response.json();

        if (result.success) {
          alert(result.message);

          const complaintType = sessionStorage.getItem("complaintType");
          if (complaintType === "Overlapping") {
            window.location.href = "/complainant/new_overlap_form";
          } else if (complaintType === "Lot Dispute") {
            window.location.href = "/complainant/complaints/lot_dispute.html";
          } else if (complaintType === "Boundary Dispute") {
            window.location.href = "/complainant/complaints/boundary_dispute.html";
          } else if (complaintType === "Pathway Dispute") {
            window.location.href = "/complainant/complaints/pathway_dispute.html";
          } else if (complaintType === "Unauthorized Occupation") {
            window.location.href = "/complainant/complaints/unauthorized_occupation.html";
          } else if (complaintType === "Illegal Construction") {
            window.location.href = "/complainant/complaints/illegal_construction.html";
          } else {
            window.location.href = "/complainant/complaints/general.html";
          }
        } else {
          alert("Error: " + result.error);
        }
      } catch (err) {
        alert("Failed to submit: " + err);
      }
    });
  </script>
</body>
</html>
