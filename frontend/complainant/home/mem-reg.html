<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="/images/logo.png">
  <title>ReklaMap</title>
  <link rel="stylesheet" href="/css/complainants.css">
</head>
<body>
    
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo-section">
        <img src="/images/logo.png" alt="ReklaMap Logo" class="logo">
        <span class="title"><span class="blue-text">Rekla</span><span class="green-text">Map</span></span>
        </div>
        <nav class="nav-menu">
        <a href="/complainant/home/dashboard.html" class="nav-item active">Home</a>
        <a href="/complainant/complaints/submitted_complaints.html" class="nav-item">Complaints</a>
        </nav>
    </aside>

  <!-- Main -->
  <main class="main">
    <article style= "margin-top: 30px;" class="card" role="main" aria-labelledby="page-title">
      <h1 id="page-title" class="page-title">HOA Member Registration</h1>

      <!-- TOP: registrant basic fields -->
      <form id="memRegForm" method="post" enctype="multipart/form-data">
        <div class="form-grid" aria-hidden="false">
          <label>Last Name<input type="text" name="reg_last"></label>
          <label>First Name<input type="text" name="reg_first"></label>
          <label>Middle Initial<input type="text" name="reg_mid"></label>
          <label>Suffix
            <select name="reg_suffix">
              <option value="" disabled selected hidden></option>
              <option>NA</option>
              <option>Sr.</option>
              <option>Jr.</option>
            </select>
          </label>

          <label>Date of Birth<input type="date" name="reg_dob"></label>
          <label>Sex
            <select name="reg_sex">
              <option value="" disabled selected hidden></option>
              <option>Male</option><option>Female</option>
            </select>
          </label>
          <label>Citizenship<input type="text" name="reg_cit"></label>
          <label>Age<input type="number" name="reg_age" min="0" step="1"></label>
        </div>

        <div class="form-grid" aria-hidden="false" style="margin-bottom: -15px;">
          <label>Years of Residence<input type="text" name="reg_year"></label>
          <label>Contact Number<input type="text" name="reg_phone"></label>
          <label>HOA
            <select name="reg_hoa" required>
              <option value="" disabled selected hidden></option>
              {% for area in areas %}
                <option value="{{ area.area_id }}">{{ area.area_name }}</option>
              {% endfor %}
            </select>
          </label>
          <label>Block Assignment<input type="text" name="reg_blk"></label>
          <label>Lot Assignment<input type="text" name="reg_lot_asn"></label>
          <label>Lot Size<input type="text" name="reg_lot_size"></label>

          <!-- Civil status column (right) -->
          <aside class="civil-status">
            <div class="label">Civil Status:</div>
              <div class="civil-grid">
                <label><input type="radio" name="fam_civil" value="single"> Single</label>
                <label><input type="radio" name="fam_civil" value="widowed"> Widowed</label>
                <label><input type="radio" name="fam_civil" value="married"> Married</label>
                <label><input type="radio" name="fam_civil" value="separated"> Separated</label>
                <label><input type="radio" name="fam_civil" value="divorced"> Divorced</label>
                <label><input type="radio" name="fam_civil" value="annulled"> Annulled</label>
              </div>
          </aside>
        </div>

        <div class="form-grid" aria-hidden="false" style="grid-template-columns: repeat(2, 1fr) !important;">
          <label>Current Address<input type="text" name="reg_cur_add"></label>
        </div>

        <!-- radio question (one option per row) -->
        <div class="radio-section" role="group">
          <p id="recipient-label">Recipient of other housing programs besides NGCCHP ?</p>
          <div class="radio-list">
            <label><input type="radio" name="recipient" value="yes"> Yes</label>
            <label><input type="radio" name="recipient" value="no"> No</label>
          </div>
        </div>

        <!-- supporting documents (stacked) -->
        <div class="support-docs" role="group">
          <p id="docs-label">What supporting documents do you have?</p>
          <div class="docs-list">
            <label><input type="checkbox" name="doc_title"> Title</label>
            <label><input type="checkbox" name="doc_contract"> Contract to Sell</label>
            <label><input type="checkbox" name="doc_fullpay"> Certificate of Full Payment</label>
            <label><input type="checkbox" name="doc_award"> Certificate of Award</label>
            <label><input type="checkbox" name="doc_agreement"> Contract/Agreement</label>
            <label><input type="checkbox" name="doc_deed"> Deed of Sale</label>
          </div>
        </div>
        
          <!-- Hidden category input -->
          <input type="hidden" name="category" value="{{ category }}">
      </div>

        <!-- actions -->
        <div class="actions">
          <button type="button" class="btn cancel" onclick="window.location.href='/complainant/home/not_registered.html'">Cancel</button>
          <button type="submit" class="btn submit">Submit</button>
        </div>
      </form>
    </article>
  </main>

  <!-- Form submission script -->
    <script>
      document.getElementById("memRegForm").addEventListener("submit", async function(e) {
        e.preventDefault(); // stop page reload

        let formData = new FormData(this);

        try {
          let response = await fetch("/complainant/memreg", {
            method: "POST",
            body: formData,
            credentials: "same-origin"
          });

          let result = await response.json();

          if (result.success) {
            alert(result.message);

            // âœ… Use the same key as in dashboard.html
            let complaintType = sessionStorage.getItem("complaintType");
             console.log("Complaint Type from sessionStorage:", complaintType); // <-- add this

            if (complaintType === "Overlapping") {
              window.location.href = "/complainant/new_overlap_form";
            } else if (complaintType === "Lot Dispute") {
              window.location.href = "/complainant/new_lot_dispute_form";
            } else if (complaintType === "Boundary Dispute") {
              window.location.href = "/complainant/new_boundary_dispute_form";
            } else if (complaintType === "Pathway Dispute") {
              window.location.href = "/complainant/complaints/pathway_dispute.html";
            } else if (complaintType === "Unauthorized Occupation") {
              window.location.href = "/complainant/complaints/unauthorized_occupation.html";
            } else if (complaintType === "Illegal Construction") {
              window.location.href = "/complainant/complaints/illegal_construction.html";
            } else {
              window.location.href = "/complainant/complaints/general.html";
            }

          } else {
            alert("Error: " + result.error);
          }
        } catch (err) {
          alert("Failed to submit: " + err);
        }
      });
      </script>

</body>
</html>