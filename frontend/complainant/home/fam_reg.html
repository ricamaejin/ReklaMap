<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="/images/logo.png">
  <title>ReklaMap</title>
  <link rel="stylesheet" href="/css/complainants.css">
</head>
<body>
    
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo-section">
        <img src="/images/logo.png" alt="ReklaMap Logo" class="logo">
        <span class="title"><span class="blue-text">Rekla</span><span class="green-text">Map</span></span>
        </div>
        <nav class="nav-menu">
        <a href="/complainant/home/dashboard.html" class="nav-item active">Home</a>
        <a href="/complainant/complaints/submitted_complaints.html" class="nav-item">Complaints</a>
        </nav>
    </aside>

  <!-- Main -->
  <main class="main">
    <article class="card" role="main" aria-labelledby="page-title">
      <h1 id="page-title" class="page-title">Family of an HOA Member Registration</h1>

      <!-- TOP: registrant basic fields -->
     <form id="famRegForm" method="post" enctype="multipart/form-data">
        <div class="form-grid" aria-hidden="false">
          <label>Last Name<input type="text" name="reg_last"></label>
          <label>First Name<input type="text" name="reg_first"></label>
          <label>Middle Name<input type="text" name="reg_mid"></label>
          <label>Suffix
            <select name="reg_suffix">
              <option value="" disabled selected hidden></option>
              <option>Sr.</option><option>Jr.</option><option>NA</option>
            </select>
          </label>

          <label>Date of Birth<input type="date" name="reg_dob"></label>
          <label>Sex
            <select name="reg_sex">
              <option value="" disabled selected hidden></option>
              <option>Male</option><option>Female</option>
            </select>
          </label>
          <label>Citizenship<input type="text" name="reg_cit"></label>
          <label>Age<input type="number" name="reg_age" min="0" step="1"></label>

          <label>Phone Number<input type="text" name="reg_phone"></label>
          <label>Year of Residence<input type="text" name="reg_year"></label>
          <label><!-- empty placeholder to keep 4 cols --></label>
        </div>
        
        <!-- separator -->
        <div class="separator" aria-hidden="true"></div>
        
        <h3>Information of Family Member:</h3><br>

        <div class="form-grid" aria-hidden="false">
          <label>Last Name<input type="text" name="parent_last"></label>
          <label>First Name<input type="text" name="parent_first"></label>
          <label>Middle Name<input type="text" name="parent_mid"></label>
          <label>Suffix
            <select name="parent_suffix">
              <option value="" disabled selected hidden></option>
              <option>NA</option>
              <option>Sr.</option>
              <option>Jr.</option>
            </select>
          </label>

          <label>Date of Birth<input type="date" name="parent_dob"></label>
          <label>Sex
            <select name="parent_sex">
              <option value="" disabled selected hidden></option>
              <option>Male</option><option>Female</option>
            </select>
          </label>
          <label>Citizenship<input type="text" name="parent_cit"></label>
          <label>Age<input type="number" name="parent_age" min="0" step="1"></label>
        </div>

        <div class="form-grid" aria-hidden="false" style="margin-bottom: -15px;">
          <label>Years of Residence<input type="text" name="parent_year"></label>
          <label>Relationship<input type="text" name="reg_relationship"></label>
          <label>HOA
              <select name="parent_hoa" required>
              <option value="" disabled selected hidden></option>
              {% for area in areas %}
                <option value="{{ area.area_id }}">{{ area.area_name }}</option>
              {% endfor %}
            </select>
          </label>
          <label>Block Assignment<input type="text" name="parent_blk"></label>
          <label>Lot Assignment<input type="text" name="parent_lot_asn"></label>
          <label>Lot Size<input type="text" name="parent_lot_size"></label>

          <!-- Civil status column (right) -->
          <aside class="civil-status">
            <div class="label">Civil Status:</div>
              <div class="civil-grid">
                <label><input type="radio" name="fam_civil" value="single"> Single</label>
                <label><input type="radio" name="fam_civil" value="widowed"> Widowed</label>
                <label><input type="radio" name="fam_civil" value="married"> Married</label>
                <label><input type="radio" name="fam_civil" value="separated"> Separated</label>
                <label><input type="radio" name="fam_civil" value="divorced"> Divorced</label>
                <label><input type="radio" name="fam_civil" value="annulled"> Annulled</label>
              </div>
          </aside>
        </div>

        <div class="form-grid" aria-hidden="false" style="grid-template-columns: repeat(2, 1fr) !important;">
          <label>Current Address<input type="text" name="reg_cur_add"></label>
        </div>

        <!-- radio question (one option per row) -->
        <div class="radio-section" role="group">
          <p id="recipient-label">Is he/she a recipient of other housing programs besides NGCCHP ?</p>
          <div class="radio-list">
            <label><input type="radio" name="recipient" value="yes"> Yes</label>
            <label><input type="radio" name="recipient" value="no"> No</label>
          </div>
        </div>

        <!-- supporting documents (stacked) -->
        <div class="support-docs" role="group">
          <p id="docs-label">What supporting documents does your family member have?</p>
          <div class="docs-list">
            <label><input type="checkbox" name="doc_title"> Title</label>
            <label><input type="checkbox" name="doc_contract"> Contract to Sell</label>
            <label><input type="checkbox" name="doc_fullpay"> Certificate of Full Payment</label>
            <label><input type="checkbox" name="doc_award"> Certificate of Award</label>
            <label><input type="checkbox" name="doc_agreement"> Contract/Agreement</label>
            <label><input type="checkbox" name="doc_deed"> Deed of Sale</label>
          </div>
        </div>

        <!-- upload signature + disclaimer -->
        <div class="upload-section">
          <p class="disclaimer">
            This signature will serve as your official compliance item. It confirms that the
            information you provided is accurate to the best of your knowledge and that you agree to
            the terms of the submission process. Make sure your signature is legible and matches
            your registered name. 
          </p>
          
          <!-- Hidden category input -->
          <input type="hidden" name="category" value="{{ category }}">

          <!-- Hidden file input -->
          <input type="file" id="signatureInput" accept="image/*" style="display:none;" />

          <!-- Upload button -->
          <button type="button" class="upload-btn" onclick="document.getElementById('signatureInput').click()">Upload Signature</button>

          <!-- File name preview -->
          <span id="signatureFileName" style="margin-left:10px; font-style:italic;"></span>
        </div>

        <!-- actions -->
        <div class="actions">
          <button type="button" class="btn cancel" onclick="window.location.href='/complainant/home/not_registered.html'">Cancel</button>
          <button type="submit" class="btn submit">Submit</button>
        </div>
      </form>
    </article>
  </main>
</body>
</html>

<!-- Script for file input preview -->
    <script>
      const sigInput = document.getElementById("signatureInput");
      const sigFileName = document.getElementById("signatureFileName");

      sigInput.addEventListener("change", function () {
        if (this.files.length > 0) {
          sigFileName.textContent = "✔ " + this.files[0].name;
        } else {
          sigFileName.textContent = "";
        }
      });
    </script>

  <!-- Form submission script -->
  <script>
    document.getElementById("famRegForm").addEventListener("submit", async function(e) {
      e.preventDefault(); // stop page reload

      let formData = new FormData(this);

      try {
        let response = await fetch("/complainant/famreg", {
          method: "POST",
          body: formData,
          credentials: "same-origin"
        });

        let result = await response.json();

        if (result.success) {
          alert(result.message);

          // ✅ Use the same key as in dashboard.html
          let complaintType = sessionStorage.getItem("complaintType");
          console.log("Complaint Type from sessionStorage:", complaintType);

          if (complaintType === "Overlapping") {
            window.location.href = "/complainant/new_overlap_form";
          } else if (complaintType === "Lot Dispute") {
            window.location.href = "/complainant/complaints/lot_dispute.html";
          } else if (complaintType === "Boundary Dispute") {
            window.location.href = "/complainant/complaints/boundary_dispute.html";
          } else if (complaintType === "Pathway Dispute") {
            window.location.href = "/complainant/complaints/pathway_dispute.html";
          } else if (complaintType === "Unauthorized Occupation") {
            window.location.href = "/complainant/complaints/unauthorized_occupation.html";
          } else if (complaintType === "Illegal Construction") {
            window.location.href = "/complainant/complaints/illegal_construction.html";
          } else {
            window.location.href = "/complainant/complaints/general.html";
          }

        } else {
          alert("Error: " + result.error);
        }
      } catch (err) {
        alert("Failed to submit: " + err);
      }
    });
  </script>
</script>