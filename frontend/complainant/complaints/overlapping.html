<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="/images/logo.png">
  <title>ReklaMap</title>
  <link rel="stylesheet" href="/css/complainants.css">
</head>
<body>
  <!-- Error Popup (centered in viewport) -->
  <div id="errorPop" 
    style="display:none;position:fixed;top:50%;left:50%;transform:translate(-50%, -50%);z-index:999;background:#e3f2fd;color:#083048;width:max-content;padding:16px 28px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.12);font-weight:500;min-width:220px;max-width:340px;transition:opacity .2s;">
    <span id="errorPopMsg"></span>
  </div>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo-section">
      <img src="/images/logo.png" alt="ReklaMap Logo" class="logo">
      <span class="title"><span class="blue-text">Rekla</span><span class="green-text">Map</span></span>
    </div>
    <nav class="nav-menu">
      <a href="/complainant/home/dashboard.html" class="nav-item">Home</a>
      <a href="/complainant/complaints/submitted_complaints.html" class="nav-item active">Complaints</a>
    </nav>
  </aside>

  <!-- Main Form -->
  <div class="main">
    <div class="form-container">
      <h1 style="text-decoration: underline;">COMPLAINT FORM <br> OVERLAPPING</h1>
      <div class="instructions">
        <p><strong>INSTRUCTION</strong></p>
        <ul>
          <li>Complete the application form properly and legibly.</li>
          <li>For checkbox items (☑), you may select more than one option if applicable.</li>
          <li>For radio button items (◉), please select only one option.</li>
          <li>If a field or question does not apply to you or you do not know the answer, write “N/A” (Not Applicable).</li>
          <li>Ensure all required fields are filled before submitting the form.</li>
        </ul>
      </div>
    
    <form id="overlapForm" enctype="multipart/form-data">
        <input type="hidden" name="complaint_id" value="{{ complaint_id }}">
        <input type="hidden" name="registration_id" value="{{ registration_id }}">

        <div class="section-header">COMPLAINANT'S DETAILS:</div>
        <div id="complainantDetails">
          <!-- Details will be populated dynamically based on registration category -->
        </div>

        <!-- Section 1 -->
        <div class="section-header">LOT DETAILS AND CLAIM:</div>

          <p>1. What is the current status of your assigned lot? <i style="font-size: 14px; font-weight: normal; color: grey;">(Select all that apply)</i></p>
          <label><input type="checkbox" name="current_status" value="survey_overlap"> Official subdivision or site survey shows overlapping boundaries</label>
          <label><input type="checkbox" name="current_status" value="coords_in_docs"> My assigned lot number/coordinates also appear in someone else’s documents</label>
          <label><input type="checkbox" name="current_status" value="residing"> I am currently residing or building on the lot</label>
          <label><input type="checkbox" name="current_status" value="vacant_overlap_records"> The lot is vacant, but subdivision/records show overlapping assignments</label>
          <label><input type="checkbox" name="current_status" value="built_by_other"> Someone else has built or is using part of the same lot</label>
          <label><input type="checkbox" name="current_status" value="other_has_docs"> Another person has documents showing the same lot as mine</label>
          <label><input type="checkbox" name="current_status" value="unsure_told_overlap" style="margin-bottom: 12px;"> I am unsure of the current usage, but I was told there is an overlap</label>

          <p>2. What are the specific block and lot numbers involved in the overlap? <i style="font-size: 14px; font-weight: normal; color: grey;">(Excluding yours)</i></p>
          <div class="pairs" id="pairsContainer" aria-live="polite">
            <!-- rows will be added here -->
          </div>
          <div class="pair-controls">
            <button type="button" class="btn add small" id="addPairBtn" style="margin-bottom: 12px;">+ Add</button>
            <span style="color:var(--muted);font-size:13px;margin-left:8px"><i style="font-size: 14px; font-weight: normal; color: grey;">(If more than one area is affected, list all applicable pairs.)</i></span>
          </div>

          <p>3. How long have you been assigned to or occupying this lot?<p>
          <label><input type="radio" name="occupancy_duration" value="<6m"> Less than 6 months</label>
          <label><input type="radio" name="occupancy_duration" value="6m-1y"> 6 months-1 year</label>
          <label><input type="radio" name="occupancy_duration" value="1-3y"> 1–3 years</label>
          <label><input type="radio" name="occupancy_duration" value="3-5y"> 3–5 years</label>
          <label><input type="radio" name="occupancy_duration" value=">5y" style="margin-bottom: 12px;"> More than 5 years</label>

          <p>4. What shows that your lot is overlapping with another claim? <i style="font-size: 14px; font-weight: normal; color: grey;">(Check all that apply)</i></p>
          <label><input type="checkbox" name="evidence" value="survey"> Official subdivision or site survey shows overlapping lot boundaries</label>
          <label><input type="checkbox" name="evidence" value="lot_in_docs"> My lot number or coordinates appear in someone else’s documents</label>
          <label><input type="checkbox" name="evidence" value="structure_on_space"> There is another structure on my assigned space</label>
          <label><input type="checkbox" name="evidence" value="markers"> Markers or fences show mismatched or shared boundary lines</label>
          <label><input type="checkbox" name="evidence" value="advice" style="margin-bottom: 12px;"> HOA, NGC, or an LGU unit advised me that my lot is overlapping</label>

          <p>5. How did you discover the overlap? <span class="help"> <i style="font-size: 14px; font-weight: normal; color: grey;">(Check all that apply)</i></span></p>
          <label><input type="checkbox" name="discover" value="informed_by_officer"> I was informed by an NHA, NGC, or barangay officer</label>
          <label><input type="checkbox" name="discover" value="saw_structure"> I saw a structure already built partially or fully on my lot</label>
          <label><input type="checkbox" name="discover" value="verbal_warning"> I received a verbal warning or notice from another claimant</label>
          <label><input type="checkbox" name="discover" value="compared_docs"> I compared documents and noticed the same block/lot number</label>
          <label><input type="checkbox" name="discover" value="advised_survey" style="margin-bottom: 12px;"> I was advised during a survey, inspection, or mapping activity</label>

          <p>6. When did the overlapping begin?</p>
          <label><input type="radio" name="construction_timeframe" value="<3m"> Less than 3 months</label>
          <label><input type="radio" name="construction_timeframe" value="3-6m"> 3–6 months</label>
          <label><input type="radio" name="construction_timeframe" value="6-12m"> 6–12 months</label>
          <label><input type="radio" name="construction_timeframe" value=">1y"> Over a year</label>
          <label><input type="radio" name="construction_timeframe" value="not_sure" style="margin-bottom: 12px;"> Not sure</label>
            
          <p>7. Who else is involved in this overlap?</p>
          <label><input type="radio" name="who_else" value="official_beneficiary"> An officially listed beneficiary with their own documents</label>
          <label><input type="radio" name="who_else" value="relative_of_beneficiary"> A relative of the listed beneficiary (not on paper)</label>
          <label><input type="radio" name="who_else" value="private_claimant"> A private claimant not from the community</label>
          <label><input type="radio" name="who_else" value="prev_occupant"> A structure built by a previous occupant</label>
          <label><input type="radio" name="who_else" value="unknown" style="margin-bottom: 12px;"> I do not know who the other claimant is</label>

          <p>8. What is the name of the involved person?</p>
          <div id="involvedPersonsContainer">
            <div class="person-input">
              <input type="text" class="involved_person_name" name="involved_person_name[]" placeholder="Enter name (if known)">
            </div>
          </div>
          <button type="button" class="btn add small" id="addPersonBtn" style="margin-left: 15px;">+ Add another person</button>

          <p>9. Is there someone who claims that your lot is overlapping with theirs?</p>
          <label><input type="radio" name="approach" value="yes" id="approachYes"> Yes</label>
          <div id="approachYesDetails" style="display: none; margin-left: 22px;">
            <p>What information or evidence do they have about the overlapping?</p>
            <label><input type="checkbox" name="approachDetails" value="same_lot_number"> Their documents show the same lot number as mine</label>
            <label><input type="checkbox" name="approachDetails" value="different_doc"> I saw documents but they did not match mine</label>
            <label><input type="checkbox" name="approachDetails" value="no_docs_seen"> I have not seen any documents from their side</label>
            <label><input type="checkbox" name="approachDetails" value="structure_covers"> Their structure covers part of my lot</label>
            <label><input type="checkbox" name="approachDetails" value="not_sure"> I am not sure / No information</label>
          </div>
          <label><input type="radio" name="approach" value="no" id="approachNo"> No</label>

          <p>10. Have you reported this to any office or authority?</p>
            <label><input type="radio" name="reported_to" value="barangay"> Yes – Barangay</label>
            <label><input type="radio" name="reported_to" value="hoa"> Yes – HOA</label>
            <label><input type="radio" name="reported_to" value="ngc"> Yes – NGC</label>
            <label><input type="radio" name="reported_to" value="no_first_time" style="margin-bottom: 12px;"> No – This is the first time</label>

          <p>11. Was a site inspection or verification done?</p>
          <label><input type="radio" name="inspection" value="barangay"> Yes – by Barangay</label>
          <label><input type="radio" name="inspection" value="hoa"> Yes – by HOA</label>
          <label><input type="radio" name="inspection" value="ngc"> Yes – by NGC</label>
          <label><input type="radio" name="inspection" value="no"> No</label>
          <label><input type="radio" name="inspection" value="not_sure" style="margin-bottom: 12px;"> Not sure</label>

          <p>12. What was the result of the report or inspection?</p>
          <label><input type="radio" name="report_result" value="other_vacate"> The other party was advised to vacate</label>
          <label><input type="radio" name="report_result" value="gather_docs"> I was advised to gather more documents</label>
          <label><input type="radio" name="report_result" value="no_action"> No action was taken</label>
          <label><input type="radio" name="report_result" value="under_investigation"> The issue is still under investigation</label>
          <label><input type="radio" name="report_result" value="overlapping_assign"> I was told the lot has overlapping assignments</label>
          <label><input type="radio" name="report_result" value="not_applicable" style="margin-bottom: 12px;"> Not applicable / No report filed</label>

          <p>13. What has the overlap issue caused or affected?</p>
          <label><input type="radio" name="impact" value="cannot_build"> I cannot build or renovate due to the boundary issue</label>
          <label><input type="radio" name="impact" value="conflict_with_family"> I am in conflict with another family over the lot</label>
          <label><input type="radio" name="impact" value="threats_or_eviction"> I received threats or was told to leave</label>
          <label><input type="radio" name="impact" value="lost_use"> I lost use of part/all of the land I was assigned</label>
          <label><input type="radio" name="impact" value="public_path"> A public path or neighbor's property is also affected</label>
          <label><input type="radio" name="impact" value="none" style="margin-bottom: 12px;"> None of the above</label>

          <!-- Section 2 -->
          <p style="font-weight: bold;">Please describe what happened briefly, including how you found out about the issue.</p>
          <textarea name="description" placeholder=""></textarea>

          <!-- Section 3 -->
          <div class="section-header">COMPLAINANT’S CONSENT AND DECLARATION</div>
          <div class="consent">
            By submitting this complaint form, I hereby consent to the collection and processing of my personal information as necessary to address the issues raised regarding the lot in question. I confirm that the information provided is accurate and complete to the best of my knowledge. I understand that any false or incomplete information may affect the handling of my complaint, and I acknowledge that my personal details will be processed in compliance with the Privacy Act and other applicable laws.
          </div>

          <div class="signature">
            <input type="file" id="signatureInput" accept="image/*" style="display:none;" />
            <button type="button" class="upload-btn" onclick="document.getElementById('signatureInput').click()">Upload Signature</button>
            <span id="signatureFileName" style="margin-left:10px;  font-style:italic;"></span>
            <button type="submit" id="submitBtn" class="btn" style="display:none; margin-top:12px;">Submit Complaint</button>
          </div>
        </div>
      </form>
    </div>

<script>
// Show error pop-up
function showErrorPop(msg) {
  const pop = document.getElementById('errorPop');
  const popMsg = document.getElementById('errorPopMsg');
  popMsg.textContent = msg;
  pop.style.display = 'block';
  pop.style.opacity = '1';
  setTimeout(() => {
    pop.style.opacity = '0';
    setTimeout(() => { pop.style.display = 'none'; }, 400);
  }, 1000);
}
/* ========== Dynamic Block/Lot pairs ========== */
(function(){
  const pairsContainer = document.getElementById('pairsContainer');
  const addPairBtn = document.getElementById('addPairBtn');

  // Create one initial pair
  function createPairRow(block = '', lot = '') {
    const row = document.createElement('div');
    row.className = 'pair-row';

    const colBlock = document.createElement('div');
    colBlock.className = 'col';
    const lblBlock = document.createElement('label');
    lblBlock.className = 'small';
    lblBlock.textContent = 'Block No.';
    const inputBlock = document.createElement('input');
    inputBlock.type = 'text';
    inputBlock.name = 'block_no[]';
    inputBlock.value = block;
    inputBlock.placeholder = 'Block No.';
    colBlock.appendChild(lblBlock);
    colBlock.appendChild(inputBlock);

    const colLot = document.createElement('div');
    colLot.className = 'col';
    const lblLot = document.createElement('label');
    lblLot.className = 'small';
    lblLot.textContent = 'Lot No.';
    const inputLot = document.createElement('input');
    inputLot.type = 'text';
    inputLot.name = 'lot_no[]';
    inputLot.value = lot;
    inputLot.placeholder = 'Lot No.';
    colLot.appendChild(lblLot);
    colLot.appendChild(inputLot);

    const removeBtn = document.createElement('button');
    removeBtn.type = 'button';
    removeBtn.className = 'remove';
    removeBtn.textContent = 'Remove';
    removeBtn.onclick = () => {
      pairsContainer.removeChild(row);
      updateRemoveButtons();
    };

    row.appendChild(colBlock);
    row.appendChild(colLot);
    row.appendChild(removeBtn);

    return row;
  }

  function updateRemoveButtons() {
    const rows = pairsContainer.querySelectorAll('.pair-row');
    rows.forEach((r, idx) => {
      const btn = r.querySelector('button.remove');
      // disable remove if only one row left
      btn.disabled = rows.length === 1;
      btn.style.opacity = btn.disabled ? 0.45 : 1;
      btn.style.cursor = btn.disabled ? 'not-allowed' : 'pointer';
    });
  }

  // initial
  pairsContainer.appendChild(createPairRow());
  updateRemoveButtons();

  addPairBtn.addEventListener('click', () => {
    pairsContainer.appendChild(createPairRow());
    updateRemoveButtons();
    // focus on new block input
    const rows = pairsContainer.querySelectorAll('.pair-row');
    const last = rows[rows.length-1];
    last.querySelector('input[name="block_no[]"]').focus();
  });
})();

/* ========== Generic 'Other' handler (if you add any radios with data-other-target) ========== */
/* The form above does not require "Other" fields, but this handler is generic:
   - Add data-other-target="ID" to a radio to show an input with that ID when selected.
   - Add data-text-selects="RADIO_ID" to an input to auto-select its radio as you type.
*/
(function(){
  // show/hide logic per radio group
  function handleGroup(name){
    const radios = Array.from(document.querySelectorAll(`input[type=radio][name="${name}"]`));
    if(!radios.length) return;
    radios.forEach(r=> r.addEventListener('change', () => {
      // hide any other-target inputs in this group
      radios.forEach(rr=>{
        const t = rr.dataset.otherTarget;
        if(t){
          const el = document.getElementById(t);
          if(!el) return;
          if(rr.checked){
            el.style.display = '';
          } else {
            el.style.display = 'none';
            if(el.tagName.toLowerCase()==='input' || el.tagName.toLowerCase()==='textarea'){
              el.value='';
            }
          }
        }
      });
    }));
  }

  // collect unique radio group names
  const radioNames = new Set();
  document.querySelectorAll('input[type=radio]').forEach(r=>{
    if(r.name) radioNames.add(r.name);
  });
  radioNames.forEach(handleGroup);

  // auto-select corresponding radio if text is typed
  document.querySelectorAll('[data-text-selects]').forEach(input => {
    const radioId = input.dataset.textSelects;
    const radio = document.getElementById(radioId);
    if(!radio) return;
    input.addEventListener('input', () => {
      radio.checked = true;
      radio.dispatchEvent(new Event('change', {bubbles:true}));
    });
  });
})();
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const overlapForm = document.getElementById('overlapForm');
  const submitBtn = document.getElementById('submitBtn');
  const signatureInput = document.getElementById('signatureInput');
  const signatureFileName = document.getElementById('signatureFileName');
  const addPersonBtn = document.getElementById('addPersonBtn');
  const involvedPersonsContainer = document.getElementById('involvedPersonsContainer');
  const approachYes = document.getElementById('approachYes');
  const approachNo = document.getElementById('approachNo');
  const approachYesDetails = document.getElementById('approachYesDetails');

  if (!overlapForm) {
    console.error("Form not found!");
    return;
  }

  // ------------------------- 
  // Handle form submit 
  // ------------------------- 
  overlapForm.addEventListener('submit', async function(e) { 
    e.preventDefault(); 
    console.log("Submit button clicked ✅"); 

    const formData = new FormData(overlapForm); 

    // Hidden fields 
    const complaintIdInput = document.querySelector('input[name="complaint_id"]'); 
    const registrationIdInput = document.querySelector('input[name="registration_id"]'); 
    if (!complaintIdInput || !registrationIdInput || !registrationIdInput.value) { 
      alert('Your registration is missing or invalid. Please make sure you are registered before submitting a complaint.'); 
      return; 
    } 
    formData.set('complaint_id', complaintIdInput.value); 
    formData.set('registration_id', registrationIdInput.value); 

    // q2 block/lot pairs 
    const q2 = Array.from(document.querySelectorAll('#pairsContainer .pair-row')).map(row => { 
      const blockInput = row.querySelector('input[name="block_no[]"]'); 
      const lotInput   = row.querySelector('input[name="lot_no[]"]'); 
      return { 
        block: blockInput ? blockInput.value : "", 
        lot:   lotInput ? lotInput.value : "" 
      }; 
    }); 
    formData.set('q2', JSON.stringify(q2)); 

    // Checkbox groups 
    function addCheckboxes(name){ 
      const values = Array.from(document.querySelectorAll(`input[name="${name}"]:checked`)) 
                          .map(cb => cb.value); 
      formData.set(name, JSON.stringify(values)); 
    } 
  // New Q1: current_status as checkbox group (stored as CSV)
    addCheckboxes('current_status');
    // Store current_status as CSV instead of JSON to fit varchar length better
    try {
      const csRaw = formData.get('current_status') || '[]';
      const csArr = JSON.parse(csRaw);
      if (Array.isArray(csArr)) {
        formData.set('current_status', csArr.join(', '));
      }
    } catch (_) {}
    addCheckboxes('evidence'); 
    addCheckboxes('discover'); 
    // Map new Q9 (approach/approachDetails) to existing other_claim for backend
    // If user picked Yes but no specific details, include a sentinel so previews
    // can still render the follow-up section (unchecked options visible).
    const approach = document.querySelector('input[name="approach"]:checked');
    if (approach && approach.value === 'yes') {
      const details = Array.from(document.querySelectorAll('input[name="approachDetails"]:checked')).map(cb => cb.value);
      if (details.length === 0) {
        formData.set('other_claim', JSON.stringify(['__yes_no_details__']));
      } else {
        formData.set('other_claim', JSON.stringify(details));
      }
    } else {
      formData.set('other_claim', JSON.stringify([]));
    }

    // Single-value fields 
    const singleFields = [ 
      'occupancy_duration', 'construction_timeframe', 'who_else', 
      'reported_to', 'inspection', 'report_result', 'impact', 'description' 
    ]; 
    singleFields.forEach(name => { 
      const elChecked = document.querySelector(`[name="${name}"]:checked`); 
      const elText = document.querySelector(`[name="${name}"]:not([type="radio"]):not([type="checkbox"])`); 
      if (elChecked) { 
        formData.set(name, elChecked.value); 
      } else if (elText) { 
        formData.set(name, elText.value || ''); 
      } 
    }); 

    // Join multiple involved persons to a single string (backend stores single q8)
    const personInputs = document.querySelectorAll('.involved_person_name');
    if (personInputs && personInputs.length) {
      const names = Array.from(personInputs).map(i => i.value).filter(Boolean);
      if (names.length) {
        // Send array for validation
        formData.set('involved_persons', JSON.stringify(names));
        // Keep the existing single string for storage
        formData.set('involved_person_name', names.join(', '));
      }
    }

    // Signature 
    if (signatureInput && signatureInput.files[0]) { 
      formData.set('signature', signatureInput.files[0]); 
    } 

    // Submit to backend 
    try { 
      const response = await fetch('/complainant/overlapping/submit_overlap', { 
        method: 'POST', 
        body: formData 
      }); 

      // Check if response is successful first
      if (response.ok) {
        // Try to parse JSON to check for success
        try {
          const result = await response.json();
          if (result.success) {
            // Redirect immediately on success
            window.location.href = '/complainant/home/dashboard.html'; 
            return; 
          }
          // If not successful, show error
          if (result.mismatches && Array.isArray(result.mismatches) && result.mismatches.length > 0) { 
            let mismatchMsg = result.message || "Mismatch found in the following field(s): " + result.mismatches.join(", ") + ". Please correct them before submitting again."; 
            showErrorPop(mismatchMsg); 
            return; 
          } 
          if (result.message) { 
            showErrorPop(result.message); 
            return; 
          } 
          showErrorPop('Unknown error occurred.'); 
        } catch (jsonErr) {
          // If JSON parsing fails but response was OK, assume success and redirect
          window.location.href = '/complainant/home/dashboard.html'; 
          return;
        }
      } else {
        // Handle non-OK responses
        try {
          const result = await response.json();
          showErrorPop(result.message || 'Error occurred while submitting.');
        } catch (jsonErr) {
          const text = await response.text(); 
          showErrorPop(text || 'Unknown error occurred.'); 
        }
      }
    } catch (err) { 
      console.error(err); 
      showErrorPop('An error occurred while submitting the complaint.'); 
    } 
  });

  // -------------------------
  // Show submit button after signature upload
  // -------------------------
  if (signatureInput) {
    signatureInput.addEventListener('change', function() {
      if (this.files && this.files[0]) {
        if (signatureFileName) signatureFileName.textContent = this.files[0].name;
        if (submitBtn) submitBtn.style.display = 'inline-block';
      } else {
        if (signatureFileName) signatureFileName.textContent = '';
        if (submitBtn) submitBtn.style.display = 'none';
      }
    });
  }
  
  // -------------------------
  // Add person button
  // -------------------------
  if (addPersonBtn && involvedPersonsContainer) {
    addPersonBtn.addEventListener('click', function() {
      const wrapper = document.createElement('div');
      wrapper.className = 'person-input';
      const input = document.createElement('input');
      input.type = 'text';
      input.className = 'involved_person_name';
      input.name = 'involved_person_name[]';
      input.placeholder = 'Enter name (if known)';
      wrapper.appendChild(input);
      involvedPersonsContainer.appendChild(wrapper);
      input.focus();
    });
  }

  // -------------------------
  // Toggle approach details
  // -------------------------
  function updateApproachDetails() {
    if (!approachYesDetails) return;
    const yesChecked = approachYes && approachYes.checked;
    approachYesDetails.style.display = yesChecked ? '' : 'none';
  }
  if (approachYes) approachYes.addEventListener('change', updateApproachDetails);
  if (approachNo) approachNo.addEventListener('change', updateApproachDetails);
  updateApproachDetails();
});
</script>


<script>
document.addEventListener("DOMContentLoaded", function() {
  fetch('/complainant/overlapping/get_overlap_session_data')
    .then(res => res.json())
    .then(data => {
      if (data.error) {
        // If registration data is missing, do nothing (no alert)
        return;
      }
      
      // Populate hidden fields
      document.querySelector('input[name="complaint_id"]').value = data.complaint_id || "";
      document.querySelector('input[name="registration_id"]').value = data.registration_id || "";
      
      // Populate complainant details based on category
      populateComplainantDetails(data);
    })
    .catch(err => console.error("❌ Failed to fetch registration data:", err));
});

function populateComplainantDetails(data) {
  const complainantDetails = document.getElementById('complainantDetails');
  if (!complainantDetails) return;
  
  if (data.category === 'family_of_member') {
    // Family member layout
    complainantDetails.innerHTML = `
      <div class="pairs">
        <div class="pair-row">
          <div class="col">
            <label class="small">Full Name:</label>
            <input type="text" name="full_name" value="${data.full_name || ''}" readonly>
          </div>
        </div>
        
        <div class="pair-row">
          <div class="col">
            <label class="small">Date of Birth:</label>
            <input type="date" name="date_of_birth" value="${data.date_of_birth || ''}" readonly 
            style="margin-top: 6px; margin-left: 13px; padding:7px;border:1px solid #cfdcea;border-radius:3px;font-size:13px;background:white; width: 96%;">
          </div>
          <div class="col">
            <label class="small">Sex:</label>
            <input type="text" name="sex" value="${data.sex || ''}" readonly>
          </div>
        </div>
        
        <div class="pair-row">
          <div class="col">
            <label class="small">Citizenship:</label>
            <input type="text" name="citizenship" value="${data.citizenship || ''}" readonly>
          </div>
          <div class="col">
            <label class="small">Age:</label>
            <input type="text" name="age" value="${data.age || ''}" readonly>
          </div>
        </div>
        
        <div class="pair-row">
          <div class="col">
            <label class="small">Phone Number:</label>
            <input type="text" name="phone_number" value="${data.phone_number || ''}" readonly>
          </div>
          <div class="col">
            <label class="small">Year of Residence:</label>
            <input type="text" name="year_of_residence" value="${data.year_of_residence || ''}" readonly>
          </div>
        </div>
        
        <div class="pair-row">
          <div class="col">
            <label class="small">Relationship:</label>
            <input type="text" name="relationship" value="${data.relationship || ''}" readonly>
          </div>
          <div class="col">
            <label class="small">Current Address:</label>
            <input type="text" name="cur_add" value="${data.cur_add || ''}" readonly>
          </div>
        </div>
      </div>
      
      ${data.parent_info ? `
      <div style="margin-top: 20px;">
        <h3 style="color: #083048; margin-bottom: 10px;">HOA Member Information</h3>
        <div class="pairs">
          <div class="pair-row">
            <div class="col">
              <label class="small">Full Name:</label>
              <input type="text" name="parent_full_name" value="${data.parent_info.full_name || ''}" readonly>
            </div>
          </div>
          
          <div class="pair-row">
            <div class="col">
              <label class="small">Date of Birth:</label>
              <input type="date" name="parent_date_of_birth" value="${data.parent_info.date_of_birth || ''}" readonly 
              style="margin-top: 6px; margin-left: 13px; padding:7px;border:1px solid #cfdcea;border-radius:3px;font-size:13px;background:white; width: 96%;">
            </div>
            <div class="col">
              <label class="small">Sex:</label>
              <input type="text" name="parent_sex" value="${data.parent_info.sex || ''}" readonly>
            </div>
          </div>
          
          <div class="pair-row">
            <div class="col">
              <label class="small">Citizenship:</label>
              <input type="text" name="parent_citizenship" value="${data.parent_info.citizenship || ''}" readonly>
            </div>
            <div class="col">
              <label class="small">Age:</label>
              <input type="text" name="parent_age" value="${data.parent_info.age || ''}" readonly>
            </div>
          </div>
          
          <div class="pair-row">
            <div class="col">
              <label class="small">Year of Residence:</label>
              <input type="text" name="parent_year_of_residence" value="${data.parent_info.year_of_residence || ''}" readonly>
            </div>
          </div>
          
          <div class="pair-row">
            <div class="col">
              <label class="small">HOA:</label>
              <input type="text" name="hoa" value="${data.hoa || ''}" readonly>
            </div>
          </div>

          <div class="pair-row">
            <div class="col">
              <label class="small">Block Assignment:</label>
              <input type="text" name="blk_num" value="${data.blk_num || ''}" readonly>
            </div>
            <div class="col">
              <label class="small">Lot Assignment:</label>
              <input type="text" name="lot_num" value="${data.lot_num || ''}" readonly>
            </div>
            <div class="col">
              <label class="small">Lot Size:</label>
              <input type="text" name="lot_size" value="${data.lot_size || ''}" readonly>
            </div>
          </div>
          
          <div class="pair-row">
            <div class="col">
              <label class="small">Civil Status:</label>
              <input type="text" name="civil_stat" value="${data.civil_status || ''}" readonly>
            </div>
            <div class="col">
              <label class="small">Current Address:</label>
              <input type="text" name="parent_cur_add" value="${data.cur_add || ''}" readonly>
            </div>
          </div>
          
          <div class="pair-row">
            <div class="col">
              <label class="small">Recipient of other housing programs:</label>
              <input type="text" name="recipient_of_other_housing" value="${data.recipient_of_other_housing || ''}" readonly>
            </div>
            <div class="col"></div>
          </div>
        </div>
      </div>
      ` : ''}
    `;
  } else {
    // Different layouts for HOA member vs non-member
    if (data.category === 'non_member') {
      // Non-member simplified layout - only show specified fields
      complainantDetails.innerHTML = `
        <div class="pairs">
          <div class="pair-row">
            <div class="col">
              <label class="small">Full Name:</label>
              <input type="text" name="full_name" value="${data.full_name || ''}" readonly>
            </div>
          </div>

          <div class="pair-row">
            <div class="col">
              <label class="small">Date of Birth:</label>
              <input type="date" name="date_of_birth" value="${data.date_of_birth || ''}" readonly 
              style="margin-top: 6px; margin-left: 13px; padding:7px;border:1px solid #cfdcea;border-radius:3px;font-size:13px;background:white; width: 96%;">
            </div>
            <div class="col">
              <label class="small">Sex:</label>
              <input type="text" name="sex" value="${data.sex || ''}" readonly>
            </div>
          </div>

          <div class="pair-row">
            <div class="col">
              <label class="small">Citizenship:</label>
              <input type="text" name="citizenship" value="${data.citizenship || ''}" readonly>
            </div>
            <div class="col">
              <label class="small">Age:</label>
              <input type="text" name="age" value="${data.age || ''}" readonly>
            </div>
          </div>

          <div class="pair-row">
            <div class="col">
              <label class="small">Phone Number:</label>
              <input type="text" name="phone_number" value="${data.phone_number || ''}" readonly>
            </div>
            <div class="col">
              <label class="small">Year of Residence:</label>
              <input type="text" name="year_of_residence" value="${data.year_of_residence || ''}" readonly>
            </div>
          </div>

          <div class="pair-row">
            <div class="col">
              <label class="small">Current Address:</label>
              <input type="text" name="cur_add" value="${data.cur_add || ''}" readonly>
            </div>
            <div class="col">
              <label class="small">Civil Status:</label>
              <input type="text" name="civil_status" value="${data.civil_status || ''}" readonly>
            </div>
          </div>

          <div class="pair-row">
            <div class="col">
              <label class="small">Area (HOA):</label>
              <input type="text" name="hoa" value="${data.hoa || ''}" readonly>
            </div>
            <div class="col">
            </div>
          </div>

          <div class="pair-row">
            <div class="col">
              <label class="small">Recipient of other housing programs:</label>
              <input type="text" name="recipient_of_other_housing" value="${data.recipient_of_other_housing || ''}" readonly>
            </div>
            <div class="col"></div>
          </div>
        </div>
      `;
    } else {
      // HOA member layout (original layout with lot information)
      complainantDetails.innerHTML = `
        <div class="pairs">
          <div class="pair-row">
            <div class="col">
              <label class="small">Full Name:</label>
              <input type="text" name="full_name" value="${data.full_name || ''}" readonly>
            </div>
          </div>

          <div class="pair-row">
            <div class="col">
              <label class="small">Date of Birth:</label>
              <input type="date" name="date_of_birth" value="${data.date_of_birth || ''}" readonly 
              style="margin-top: 6px; margin-left: 13px; padding:7px;border:1px solid #cfdcea;border-radius:3px;font-size:13px;background:white; width: 96%;">
            </div>
            <div class="col">
              <label class="small">Sex:</label>
              <input type="text" name="sex" value="${data.sex || ''}" readonly>
            </div>
          </div>

          <div class="pair-row">
            <div class="col">
              <label class="small">Civil Status:</label>
              <input type="text" name="civil_stat" value="${data.civil_status || ''}" readonly>
            </div>
            <div class="col">
              <label class="small">Citizenship:</label>
              <input type="text" name="citizenship" value="${data.citizenship || ''}" readonly>
            </div>
          </div>

          <div class="pair-row">
            <div class="col">
              <label class="small">Current Address:</label>
              <input type="text" name="cur_add" value="${data.cur_add || ''}" readonly>
            </div>
          </div>

          <div class="pair-row">
            <div class="col">
              <label class="small">HOA:</label>
              <input type="text" name="hoa" value="${data.hoa || ''}" readonly>
            </div>
          </div>

          <div class="pair-row">
            <div class="col">
              <label class="small">Block Assignment:</label>
              <input type="text" name="blk_num" value="${data.blk_num || ''}" readonly>
            </div>
            <div class="col">
              <label class="small">Lot Assignment:</label>
              <input type="text" name="lot_num" value="${data.lot_num || ''}" readonly>
            </div>
            <div class="col">
              <label class="small">Lot Size:</label>
              <input type="text" name="lot_size" value="${data.lot_size || ''}" readonly>
            </div>
          </div>

          <div class="pair-row">
            <div class="col">
              <label class="small">Phone Number:</label>
              <input type="text" name="phone_number" value="${data.phone_number || ''}" readonly>
            </div>
            <div class="col"></div>
          </div>
        </div>
      `;
    }
  }
}
</script>

</body>
</html>