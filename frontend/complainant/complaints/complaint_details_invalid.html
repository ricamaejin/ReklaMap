<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="/images/logo.png">
  <title>ReklaMap</title>
  <link rel="stylesheet" href="/css/complainants.css">
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo-section">
      <img src="/images/logo.png" alt="ReklaMap Logo" class="logo">
      <span class="title"><span class="blue-text">Rekla</span><span class="green-text">Map</span></span>
    </div>
    <nav class="nav-menu">
      <a href="/complainant/home/dashboard.html" class="nav-item">Home</a>
      <a href="/complainant/complaints/submitted_complaints.html" class="nav-item active">Complaints</a>
    </nav>
  </aside>


  <!-- Main Content (match overlapping.html sizing) -->
  <div class="main">
    <div class="form-container">
  <h2 id="invalidText" class="invalid-header">Invalid Complaint</h2>
  <h1 class="underlined-title">COMPLAINT FORM <br> OVERLAPPING</h1>
      <div class="instructions">
        <p><strong>INSTRUCTION</strong></p>
        <ul>
          <li>Complete the application form properly and legibly.</li>
          <li>For checkbox items (☑), you may select more than one option if applicable.</li>
          <li>For radio button items (◉), please select only one option.</li>
          <li>If a field or question does not apply to you or you do not know the answer, write “N/A” (Not Applicable).</li>
          <li>Ensure all required fields are filled before submitting the form.</li>
        </ul>
      </div>

      <form>
        <input type="hidden" name="complaint_id" value="{{ complaint.complaint_id }}">
        <input type="hidden" name="registration_id" value="{{ registration.registration_id }}">

        <div class="section-header">COMPLAINANT'S DETAILS:</div>
        
        {% if registration.category == 'family_of_member' %}
          <!-- Family member layout -->
          <div class="pairs">
            <div class="pair-row">
              <div class="col">
                <label class="small">Full Name:</label>
                <input type="text" name="full_name" value="{% for part in [registration.first_name, registration.middle_name, registration.last_name, registration.suffix] if part %}{{ part }} {% endfor %}" readonly>
              </div>
            </div>
            
            <div class="pair-row">
              <div class="col">
                <label class="small">Date of Birth:</label>
                <input type="date" name="date_of_birth" value="{{ registration.date_of_birth }}" readonly>
              </div>
              <div class="col">
                <label class="small">Sex:</label>
                <input type="text" name="sex" value="{{ registration.sex }}" readonly>
              </div>
            </div>
            
            <div class="pair-row">
              <div class="col">
                <label class="small">Citizenship:</label>
                <input type="text" name="citizenship" value="{{ registration.citizenship }}" readonly>
              </div>
              <div class="col">
                <label class="small">Age:</label>
                <input type="text" name="age" value="{{ registration.age }}" readonly>
              </div>
            </div>
            
            <div class="pair-row">
              <div class="col">
                <label class="small">Phone Number:</label>
                <input type="text" name="phone_number" value="{{ registration.phone_number }}" readonly>
              </div>
              <div class="col">
                <label class="small">Year of Residence:</label>
                <input type="text" name="year_of_residence" value="{{ registration.year_of_residence }}" readonly>
              </div>
            </div>
            
            <div class="pair-row">
              <div class="col">
                <label class="small">Relationship:</label>
                <input type="text" name="relationship" value="{{ relationship or '' }}" readonly>
              </div>
              <div class="col">
                <label class="small">Current Address:</label>
                <input type="text" name="cur_add" value="{{ registration.current_address }}" readonly>
              </div>
            </div>
          </div>
          
          {% if parent_info %}
          <div class="mt-20">
            <h3 class="subtitle">HOA Member Information</h3>
            <div class="pairs">
              <div class="pair-row">
                <div class="col">
                  <label class="small">Full Name:</label>
                  <input type="text" name="parent_full_name" value="{{ parent_info.full_name or '' }}" readonly>
                </div>
              </div>
              
              <div class="pair-row">
                <div class="col">
                  <label class="small">Date of Birth:</label>
                  <input type="date" name="parent_date_of_birth" value="{{ parent_info.date_of_birth }}" readonly>
                </div>
                <div class="col">
                  <label class="small">Sex:</label>
                  <input type="text" name="parent_sex" value="{{ parent_info.sex or '' }}" readonly>
                </div>
              </div>
              
              <div class="pair-row">
                <div class="col">
                  <label class="small">Citizenship:</label>
                  <input type="text" name="parent_citizenship" value="{{ parent_info.citizenship or '' }}" readonly>
                </div>
                <div class="col">
                  <label class="small">Age:</label>
                  <input type="text" name="parent_age" value="{{ parent_info.age or '' }}" readonly>
                </div>
              </div>
              
              <div class="pair-row">
                <div class="col">
                  <label class="small">Phone Number:</label>
                  <input type="text" name="parent_phone_number" value="{{ parent_info.phone_number or '' }}" readonly>
                </div>
                <div class="col">
                  <label class="small">Year of Residence:</label>
                  <input type="text" name="parent_year_of_residence" value="{{ parent_info.year_of_residence or '' }}" readonly>
                </div>
              </div>
              
              <div class="pair-row">
                <div class="col">
                  <label class="small">HOA:</label>
                  <input type="text" name="hoa" value="{{ get_area_name(registration.hoa) if registration.hoa else '' }}" readonly>
                </div>
                <div class="col">
                  <label class="small">Block Assignment:</label>
                  <input type="text" name="blk_num" value="{{ registration.block_no }}" readonly>
                </div>
              </div>
              
              <div class="pair-row">
                <div class="col">
                  <label class="small">Lot Assignment:</label>
                  <input type="text" name="lot_num" value="{{ registration.lot_no }}" readonly>
                </div>
                <div class="col">
                  <label class="small">Lot Size:</label>
                  <input type="text" name="lot_size" value="{{ registration.lot_size }}" readonly>
                </div>
              </div>
              
              <div class="pair-row">
                <div class="col">
                  <label class="small">Civil Status:</label>
                  <input type="text" name="civil_status" value="{{ registration.civil_status }}" readonly>
                </div>
                <div class="col">
                  <label class="small">Recipient of Other Housing:</label>
                  <input type="text" name="recipient_of_other_housing" value="{{ registration.recipient_of_other_housing }}" readonly>
                </div>
              </div>
            </div>
          </div>
          {% endif %}
          
        {% else %}
          <!-- HOA member or non-member layout -->
          {% if registration.category == 'non_member' %}
            <!-- Non-member simplified layout - only show specified fields -->
            <div class="pairs">
              <div class="pair-row">
                <div class="col">
                  <label class="small">Full Name:</label>
                  <input type="text" name="full_name" value="{% for part in [registration.first_name, registration.middle_name, registration.last_name, registration.suffix] if part %}{{ part }} {% endfor %}" readonly>
                </div>
              </div>
              <div class="pair-row">
                <div class="col">
                  <label class="small">Date of Birth:</label>
                  <input type="date" name="date_of_birth" value="{{ registration.date_of_birth }}" readonly>
                </div>
                <div class="col">
                  <label class="small">Sex:</label>
                  <input type="text" name="sex" value="{{ registration.sex }}" readonly>
                </div>
              </div>
              <div class="pair-row">
                <div class="col">
                  <label class="small">Citizenship:</label>
                  <input type="text" name="citizenship" value="{{ registration.citizenship }}" readonly>
                </div>
                <div class="col">
                  <label class="small">Age:</label>
                  <input type="text" name="age" value="{{ registration.age }}" readonly>
                </div>
              </div>
              <div class="pair-row">
                <div class="col">
                  <label class="small">Phone Number:</label>
                  <input type="text" name="phone_number" value="{{ registration.phone_number }}" readonly>
                </div>
                <div class="col">
                  <label class="small">Year of Residence:</label>
                  <input type="text" name="year_of_residence" value="{{ registration.year_of_residence }}" readonly>
                </div>
              </div>
              <div class="pair-row">
                <div class="col">
                  <label class="small">Current Address:</label>
                  <input type="text" name="cur_add" value="{{ registration.current_address }}" readonly>
                </div>
                <div class="col">
                  <label class="small">Civil Status:</label>
                  <input type="text" name="civil_status" value="{{ registration.civil_status }}" readonly>
                </div>
              </div>
              <div class="pair-row">
                <div class="col">
                  <label class="small">Recipient of other housing programs:</label>
                  <input type="text" name="recipient_of_other_housing" value="{{ registration.recipient_of_other_housing }}" readonly>
                </div>
                <div class="col"></div>
              </div>
            </div>
          {% else %}
            <!-- HOA member layout (original layout with lot information) -->
            <div class="pairs">
              <div class="pair-row">
                <div class="col">
                  <label class="small">Full Name:</label>
                  <input type="text" name="full_name" value="{% for part in [registration.first_name, registration.middle_name, registration.last_name, registration.suffix] if part %}{{ part }} {% endfor %}" readonly>
                </div>
              </div>
              <div class="pair-row">
                <div class="col">
                  <label class="small">Date of Birth:</label>
                  <input type="date" name="date_of_birth" value="{{ registration.date_of_birth }}" readonly>
                </div>
                <div class="col">
                  <label class="small">Sex:</label>
                  <input type="text" name="sex" value="{{ registration.sex }}" readonly>
                </div>
              </div>
              <div class="pair-row">
                <div class="col">
                  <label class="small">Civil Status:</label>
                  <input type="text" name="civil_stat" value="{{ registration.civil_status }}" readonly>
                </div>
                <div class="col">
                  <label class="small">Citizenship:</label>
                  <input type="text" name="citizenship" value="{{ registration.citizenship }}" readonly>
                </div>
              </div>
              <div class="pair-row">
                <div class="col">
                  <label class="small">Current Address:</label>
                  <input type="text" name="cur_add" value="{{ registration.current_address }}" readonly>
                </div>
                <div class="col">
                  <label class="small">HOA:</label>
                  <input type="text" name="hoa" value="{{ get_area_name(registration.hoa) if registration.hoa else '' }}" readonly>
                </div>
              </div>
              <div class="pair-row">
                <div class="col">
                  <label class="small">Block Assignment Number:</label>
                  <input type="text" name="blk_num" value="{{ registration.block_no }}" readonly>
                </div>
                <div class="col">
                  <label class="small">Lot Assignment Number:</label>
                  <input type="text" name="lot_num" value="{{ registration.lot_no }}" readonly>
                </div>
                <div class="col">
                  <label class="small">Lot Area Size:</label>
                  <input type="text" name="lot_size" value="{{ registration.lot_size }}" readonly>
                </div>
              </div>
              <div class="pair-row">
                <div class="col">
                  <label class="small">Phone Number:</label>
                  <input type="text" name="phone_number" value="{{ registration.phone_number }}" readonly>
                </div>
                <div class="col"></div>
              </div>
            </div>
          {% endif %}
        {% endif %}

        <div class="section-header">LOT DETAILS AND CLAIM:</div>

        {% for field in form_structure %}
          {% if field.type == 'block_lot_pairs' %}
            <p>{{ field.label }}</p>
            {% set pairs = answers[field.name] %}
            <div class="pairs">
              {% if pairs %}
                {% for pair in pairs %}
                <div class="pair-row">
                  <div class="col">
                    <label class="small">Block No.</label>
                    <input type="text" value="{{ pair.block or pair['block'] }}" disabled title="Block No." aria-label="Block No.">
                  </div>
                  <div class="col">
                    <label class="small">Lot No.</label>
                    <input type="text" value="{{ pair.lot or pair['lot'] }}" disabled title="Lot No." aria-label="Lot No.">
                  </div>
                </div>
                {% endfor %}
              {% else %}
                <div class="readonly-value">None</div>
              {% endif %}
            </div>

          {% elif field.type == 'radio' %}
            <p>{{ field.label }}</p>
            {% set raw = answers[field.name] if field.name in answers else '' %}
            {% set raw_str = raw|string %}
            {% set is_multi = ',' in raw_str %}
            {% if is_multi %}
              {% set selected_list = raw_str|replace(' ', '')|split(',') %}
              <div class="checkbox-group">
                {% for val, label in field.options %}
                  <label class="option">
                    <input type="checkbox" disabled {% if val in selected_list %}checked{% endif %}> {{ label }}
                  </label>
                {% endfor %}
              </div>
            {% else %}
              <div class="radio-group">
                {% for val, label in field.options %}
                  <label class="option">
                    <input type="radio" name="{{ field.name }}" value="{{ val }}" disabled {% if raw_str == val %}checked{% endif %}>
                    {{ label }}
                  </label>
                {% endfor %}
              </div>
            {% endif %}

          {% elif field.type == 'checkbox' %}
            {% if field.name == 'q9' %}<div class="indent-subquestion">{% endif %}
            <p>{{ field.label }}</p>
            {% set selected = answers[field.name] if field.name in answers else [] %}
            <div class="checkbox-group">
              {% for val, label in field.options %}
                <label class="option">
                  <input type="checkbox" name="{{ field.name }}" value="{{ val }}" disabled {% if selected and (val in selected) %}checked{% endif %}>
                  {{ label }}
                </label>
              {% endfor %}
            </div>
            {% if field.name == 'q9' %}</div>{% endif %}

          {% elif field.type == 'text' %}
            <p>{{ field.label }}</p>
            <input type="text" value="{{ answers[field.name] }}" disabled title="{{ field.label }}" aria-label="{{ field.label }}">

          {% elif field.type == 'textarea' %}
            <p><strong>{{ field.label }}</strong></p>
            <textarea readonly title="{{ field.label }}" aria-label="{{ field.label }}">{{ answers[field.name] }}</textarea>

          {% elif field.type == 'signature' %}
            <div class="signature">
              {% if answers.signature %}
                <a href="{{ url_for('overlapping.uploaded_signature', filename=answers.signature) }}" target="_blank">View Signature</a>
              {% else %}
                <p><em>No signature uploaded</em></p>
              {% endif %}
            </div>
          {% endif %}
        {% endfor %}

        <div class="section-header">COMPLAINANT’S CONSENT AND DECLARATION</div>
        <div class="consent">
          By submitting this complaint form, I hereby consent to the collection and processing of my personal information as necessary to address the issues raised regarding the lot in question. I confirm that the information provided is accurate and complete to the best of my knowledge. I understand that any false or incomplete information may affect the handling of my complaint, and I acknowledge that my personal details will be processed in compliance with the Privacy Act and other applicable laws.
        </div>
      </form>
      <!-- Submit Another Complaint (shown only if user can add) -->
      <div class="signature">
        <button id="submitAnotherBtn" class="add-btn hidden" type="button">Submit Another Complaint</button>
      </div>
    </div>
  </div>

  <!-- Complaint Status Popup -->
  <div class="modal-overlay" id="modal">
    <div class="modal">
      <div class="modal-header">
        <h2>Complaint Status</h2>
        <div id="datetime">
          <div id="date"></div>
          <div id="time"></div>
        </div>
      </div>
      <hr>
  <!-- Status Description -->
  <textarea aria-label="Invalid complaint reason" readonly>Invalid Complaint
{% if complaint.rejection_reason %}
Reason: {{ complaint.rejection_reason }}
{% else %}
Reason: The name and/or block/lot do not match any registered beneficiary.
{% endif %}
</textarea>
      <div class="modal-footer">
        <button class="btn-close" onclick="closeComplaint()">Close</button>
      </div>
    </div>
  </div>

  

  <script>
  const modalOverlay = document.getElementById("modal");
  const invalidText = document.getElementById("invalidText");

  // Show popup immediately on page load
  window.addEventListener('DOMContentLoaded', () => {
    modalOverlay.style.display = "flex";
    updateDateTime();
  });

  // Make 'Invalid Complaint' text clickable to reopen popup
  invalidText.onclick = () => {
    modalOverlay.style.display = "flex";
    updateDateTime();
  };

  function closeComplaint() {
    modalOverlay.style.display = "none";
  }

  window.onclick = (event) => {
    if (event.target === modalOverlay) {
      closeComplaint();
    }
  };

  function updateDateTime() {
    const now = new Date();
    const date = now.toLocaleDateString("en-US", {
      weekday: "long",
      year: "numeric",
      month: "long",
      day: "numeric"
    });
    const time = now.toLocaleTimeString("en-US", {
      hour: "2-digit",
      minute: "2-digit",
    });

    document.getElementById("date").textContent = date;
    document.getElementById("time").textContent = time;
  }

  
  </script>

  <!-- Add Complaint Modal (same functionality as dashboard) -->
  <div class="modal-overlay" id="addComplaintModal">
    <div class="modal">
      <div class="modal-header">
        <h2>Action</h2>
        <div id="addComplaintDatetime"></div>
      </div>
      <hr>
      <div class="modal-body-scroll">
        <label for="addComplaintType">Type of Complaint:</label>
        <select id="addComplaintType" onchange="updateAddComplaintDesc()">
          <option value="" disabled selected hidden>Select Type of Complaint</option>
          <option value="Overlapping">Overlapping</option>
          <option value="Lot Dispute">Lot Dispute</option>
          <option value="Boundary Dispute">Boundary Dispute</option>
          <option value="Pathway Dispute">Pathway Dipute</option>
          <option value="Unauthorized Occupation">Unauthorized Occupation</option>
          <option value="Illegal Construction">Illegal Construction</option>
        </select>

        <!-- Complaint Description -->
        <div class="complaint-desc ml-15 hidden" id="addComplaintDesc">
          <h3 id="addComplaintDescTitle"></h3>
          <p id="addComplaintDescText"></p>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-cancel" onclick="closeAddComplaint()">Cancel</button>
        <button class="btn-save" onclick="goToRegistrationFromInvalid()">Select</button>
      </div>
    </div>
  </div>

  <script>
    // descriptions copied from dashboard
    const addComplaintDescriptions = {
      "Overlapping": "Refers to a situation where two or more lots were mistakenly assigned to the same piece of land due to errors in the land survey or subdivision plan. As a result, the official boundaries of different lots end up occupying the same physical space. This can lead to multiple individuals or families being issued documents (such as titles or lot award certificates) that point to the same area. Overlapping causes confusion, delays in processing land ownership, and conflicts over who has the right to use or stay on the land.\n\nTumutukoy ito sa sitwasyon kung saan ang dalawang lote o higit pa ay naitalaga sa iisang bahagi ng lupa dahil sa pagkakamali sa ginawang survey o plano ng pagkakahati ng lupa. Dahil dito, ang opisyal na hangganan ng mga lote ay nagkakasalubong o nagkapatong, kaya’t nagkakaroon ng higit sa isang taong nabigyan ng dokumento (gaya ng titulo o sertipiko ng pagkakaloob ng lote) para sa parehong lugar. Ang ganitong kaso ay nagdudulot ng kalituhan, pagkaantala sa pagpoproseso ng pagmamay-ari, at alitan kung sino ang may karapatang gamitin o manatili sa lupa.",
      "Lot Dispute": "Refers to situations where there is a conflict involving the lot officially assigned to you. This may include cases where someone else is claiming, occupying, or using your lot; where your name does not appear on the beneficiary list; or where there are errors, overlapping claims, or internal family disputes about who has rightful use or ownership of the lot.\n\nTumutukoy ito sa mga sitwasyon kung saan may alitan o hindi pagkakaunawaan tungkol sa lote na opisyal na naitalaga sa iyo. Kabilang dito ang mga kaso kung saan may ibang taong umaangkin, gumagamit, o nakatira sa iyong lote; kapag hindi nakalista ang iyong pangalan sa talaan ng mga benepisyaryo; o kapag may pagkakamali sa dokumento, magkapatong na pag-aangkin, o alitang pampamilya tungkol sa kung sino ang may karapatang gumamit o magmay-ari ng lote.",
      "Boundary Dispute": "A disagreement between neighboring landowners regarding the exact location of property lines or boundaries, often caused by inaccurate surveys, unclear titles, or encroachments.\n\nHindi pagkakaunawaan sa pagitan ng magkatabing may-ari ng lupa tungkol sa tiyak na lokasyon ng hangganan ng ari-arian, na madalas na dulot ng maling survey, hindi malinaw na titulo, o paglabag sa hangganan.",
      "Pathway Dispute": "Refers to conflicts that arise when residents or neighbors disagree over the use, access, or ownership of a pathway. These disputes typically involve blocked passageways, claims of private vs. public access, or disagreements over shared right-of-way.\n\nTumutukoy sa mga alitan na nagaganap kapag hindi nagkakasundo ang mga residente o kapitbahay sa paggamit, pag-access, o pagmamay-ari ng isang daanan. Karaniwan itong kaugnay ng mga hinarang na daanan, pagtatalo kung pribado o pampubliko ang access, o hindi pagkakasundo sa karapatang gamitin ang daanan.",
      "Unauthorized Occupation": "Refers to cases where a person is living in, using, or constructing on a lot without legal authority or official assignment. This includes individuals who are not listed as beneficiaries, do not hold valid documents, or have occupied the property without permission from the rightful owner or approval from government housing authorities.\n\nTumutukoy ito sa mga kaso kung saan may taong naninirahan, gumagamit, o nagtatayo sa isang lote nang walang legal na pahintulot o opisyal na pagkakatalaga. Kasama rito ang mga indibidwal na hindi nakalista bilang benepisyaryo, walang wastong dokumento, o sumakop sa lupa nang walang pahintulot mula sa tunay na may-ari o awtorisasyon mula sa ahensyang nangangasiwa sa pabahay ng pamahalaan.",
      "Illegal Construction": "Occurs when a person illegally occupies or builds structures on land that belongs to another individual or the government without proper authorization.\n\nNangyayari kapag ang isang tao ay iligal na sumakop o nagtayo ng mga istruktura sa lupang pagmamay-ari ng ibang tao o ng pamahalaan nang walang tamang pahintulot."
    };

    (function(){
      const modal = document.getElementById('addComplaintModal');
      const dateEl = document.getElementById('addComplaintDatetime');
      const select = document.getElementById('addComplaintType');
      const descWrap = document.getElementById('addComplaintDesc');
      const descTitle = document.getElementById('addComplaintDescTitle');
      const descText = document.getElementById('addComplaintDescText');
      const submitAnotherBtn = document.getElementById('submitAnotherBtn');
      let interval = null;

      function updateDateTime() {
        const now = new Date();
        const dateStr = now.toLocaleDateString('en-US', { weekday: 'short', year: 'numeric', month: 'long', day: 'numeric' });
        const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute:'2-digit', hour12: true });
        dateEl.innerHTML = `${dateStr}<br>${timeStr}`;
      }

      window.openAddComplaint = function(){
        if (!modal) return;
        modal.style.display = 'flex';
        modal.setAttribute('aria-hidden', 'false');
        updateDateTime();
        if (!interval) interval = setInterval(updateDateTime, 1000);
        if (select) {
          select.value = "";
          descWrap.style.display = 'none';
        }
      }
      window.closeAddComplaint = function(){
        if (!modal) return;
        modal.style.display = 'none';
        modal.setAttribute('aria-hidden', 'true');
        if (interval) { clearInterval(interval); interval = null; }
      }
      window.updateAddComplaintDesc = function(){
        const type = (select && select.value) ? select.value : '';
        if (type && addComplaintDescriptions[type]) {
          descTitle.textContent = type;
          descText.textContent = addComplaintDescriptions[type];
          descWrap.style.display = 'block';
        } else {
          descWrap.style.display = 'none';
          descTitle.textContent = '';
          descText.textContent = '';
        }
      }

      // Button click
      if (submitAnotherBtn) {
        submitAnotherBtn.addEventListener('click', () => window.openAddComplaint());
      }

      // Outside click to close
      if (modal) {
        modal.addEventListener('click', function (e) {
          if (e.target === modal) window.closeAddComplaint();
        });
      }

      // Show/hide Submit Another Complaint depending on current complaints
      document.addEventListener('DOMContentLoaded', async () => {
        try {
          const res = await fetch('/complainant/complaints/submitted');
          const data = await res.json();
          if (data.success) {
            const complaints = data.complaints || [];
            const hasValidComplaint = complaints.some(c => c.status !== 'Invalid');
            if (!hasValidComplaint) {
              submitAnotherBtn.classList.remove('hidden');
            } else {
              submitAnotherBtn.classList.add('hidden');
            }
          }
        } catch (err) {
          // On error, keep hidden
        }
      });
    })();

    async function goToRegistrationFromInvalid() {
      const typeSel = document.getElementById('addComplaintType');
      const type = typeSel ? typeSel.value : '';
      if (!type) {
        alert('Please select a complaint type first.');
        return;
      }
      sessionStorage.setItem('complaintType', type);
      try {
        const res = await fetch('/complainant/start-complaint', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({ type })
        });
        if (res.redirected) {
          window.location.href = res.url;
        } else {
          const data = await res.json();
          alert(data.message || 'Unable to proceed.');
        }
      } catch (err) {
        alert('Error: ' + err);
      }
    }
  </script>
</body>
</html>
