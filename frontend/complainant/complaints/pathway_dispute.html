<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="/images/logo.png">
  <title>ReklaMap</title>
  <link rel="stylesheet" href="/css/complainants.css">
</head>
<body>

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo-section">
      <img src="/images/logo.png" alt="ReklaMap Logo" class="logo">
      <span class="title"><span class="blue-text">Rekla</span><span class="green-text">Map</span></span>
    </div>
    <nav class="nav-menu">
      <a href="/complainant/home/dashboard.html" class="nav-item">Home</a>
      <a href="/complainant/complaints/submitted_complaints.html" class="nav-item active">Complaints</a>
    </nav>
  </aside>
  

  <!-- Main Form -->
  <div class="main">
    <div class="form-container">
      <form id="BoundaryDisputeForm">
        <h1 style="text-decoration: underline;">COMPLAINT FORM <br> PATHWAY DISPUTE</h1>
        <div class="instructions">
          <p><strong>INSTRUCTION</strong></p>
          <ul>
            <li>Complete the application form properly and legibly.</li>
            <li>For checkbox items (☑), you may select more than one option if applicable.</li>
            <li>For radio button items (◉), please select only one option.</li>
            <li>If a field or question does not apply to you or you do not know the answer, write “N/A” (Not Applicable).</li>
            <li>Ensure all required fields are filled before submitting the form.</li>
          </ul>
        </div>

        <div class="section-header">COMPLAINANT'S DETAILS:</div>
        <div id="complainantDetails"></div>

        <!-- Section 1 -->
        <div class="section-header">LOT DETAILS AND CLAIM:</div>
        <p style="font-weight: bold;">1. What type of pathway is being encroached upon?</p>
        <label><input type="radio" name="possession"> Public sidewalk (pedestrian path)</label>
        <label><input type="radio" name="possession"> Common path/alley used by residents</label>
        <label><input type="radio" name="possession"> Government-declared easement or right-of-way</label>
        <label><input type="radio" name="possession" style="margin-bottom: 12px;"> Path used for access to utilities (water lines, drainage, etc.)</label>


        <p style="font-weight: bold;">2. What is the nature of the encroachment?</p>
        <label><input type="radio" name="nature"> A permanent structure (e.g., house extension, wall) was built on the path</label>
        <label><input type="radio" name="nature"> A fence or gate blocks pedestrian access</label>
        <label><input type="radio" name="nature"> A store or business has occupied the pathway</label>
        <label><input type="radio" name="nature"> Temporary materials (e.g., chairs, tables, stalls) regularly block the path</label>
        <label><input type="radio" name="nature"> Vehicle/s parked long-term on the path or right-of-way</label>
        <label><input type="radio" name="nature" style="margin-bottom: 12px;"> Construction debris or materials are placed on the path</label>

        <p style="font-weight: bold;">3. How long has the pathway been obstructed or encroached?</p>
        <label><input type="radio" name="conflict"> Less than 1 month</label>
        <label><input type="radio" name="conflict"> 1-6 months</label>
        <label><input type="radio" name="conflict"> More than 6 months</label>
        <label><input type="radio" name="conflict" style="margin-bottom: 12px;"> Not sure</label>

        <p style="font-weight: bold;">4. Is the obstruction still present at the time of filing this complaint?</p>
        <label><input type="radio" name="obstruction_present"> Yes – fully blocked</label>
        <label><input type="radio" name="obstruction_present"> Yes – partially blocked</label>
        <label><input type="radio" name="obstruction_present"> No – it was removed but may return</label>
        <label><input type="radio" name="obstruction_present"> No</label>
        <label><input type="radio" name="obstruction_present" style="margin-bottom: 12px;"> Not sure</label>

        <p style="font-weight: bold;">5. How has this encroachment affected your access or mobility? <i style="font-size: 14px; font-weight: normal; color: grey;">(Check all that apply)</i></p>
        <label><input type="checkbox"> I can no longer pass through the area</label>
        <label><input type="checkbox"> The path has become unsafe or too narrow</label>
        <label><input type="checkbox"> Children, elderly, or PWDs cannot safely use the path</label>
        <label><input type="checkbox"> The obstruction forces people to walk on the road</label>
        <label><input type="checkbox" style="margin-bottom: 12px;"> Emergency vehicles or services are affected</label>

        <p style="font-weight: bold;">6. Have other residents or the barangay raised similar concerns?</p>
        <label><input type="radio" name="residents_concerned"> Yes</label>
        <label><input type="radio" name="residents_concerned"> No</label>
        <label><input type="radio" name="residents_concerned" style="margin-bottom: 12px;"> Not sure</label>

        <p style="font-weight: bold;">7. Has the encroaching party been informed or warned by anyone?</p>
        <label><input type="radio" name="party_informed"> Yes – by me</label>
        <label><input type="radio" name="party_informed"> Yes – by barangay officials</label>
        <label><input type="radio" name="party_informed"> No</label>
        <label><input type="radio" name="party_informed" style="margin-bottom: 12px;"> Not sure</label>

        <p><strong>8. Has the dispute led to any of the following? </strong><i style="font-size: 14px; font-weight: normal; color: grey;"> (Check all that apply)</i></p>
        <label><input type="checkbox"> Threats or harassment</label>
        <label><input type="checkbox"> Physical altercation</label>
        <label><input type="checkbox"> Demolition or forced entry</label>
        <label><input type="checkbox"> Property damage</label>
        <label><input type="checkbox" style="margin-bottom: 12px;" value="None"> None</label>

        <label><strong>9. Have you reported this boundary issue to any office or authority?</strong><i style="font-size: 14px; font-weight: normal; color: grey;"> (Check all that apply)</i></label>
        <label><input type="checkbox" name="boundary_reported_to[]" value="Barangay"> Barangay</label>
        <label><input type="checkbox" name="boundary_reported_to[]" value="HOA"> HOA</label>
        <label><input type="checkbox" name="boundary_reported_to[]" value="NGC"> NGC</label>
        <label><input type="checkbox" name="boundary_reported_to[]" value="NGC"> USAD - PHASELAD</label>
        <label><input type="checkbox" name="boundary_reported_to[]" value="none"> None</label>


        <label><strong>10. Was there any site inspection or verification conducted?</strong></label>
        <label><input type="radio" name="site_inspection" value="Yes - Barangay" required> Yes – by Barangay</label>
        <label><input type="radio" name="site_inspection" value="Yes - HOA"> Yes – by HOA</label>
        <label><input type="radio" name="site_inspection" value="Yes - NGC"> Yes – by NGC</label>
        <label><input type="radio" name="site_inspection" value="Yes - NGC"> Yes – by USAD - PHASELAD</label>
        <label><input type="radio" name="site_inspection" value="No"> No</label>
        <label><input type="radio" name="site_inspection" value="Not sure"> Not sure</label>

        <label><strong>11. What was the result of the report or inspection?</strong><i style="font-size: 14px; font-weight: normal; color: grey;"> (Check all that apply)</i></label>
        <label><input type="checkbox" name="site_result[]" value="Advised to adjust or vacate"> The other party was advised to adjust or vacate</label>
        <label><input type="checkbox" name="site_result[]" value="Asked to provide more documents"> I was advised to provide more documents</label>
        <label><input type="checkbox" name="site_result[]" value="Still under investigation"> The issue is still under investigation</label>
        <label><input type="checkbox" name="site_result[]" value="No action taken"> No action was taken</label>
        <label><input type="checkbox" name="site_result[]" value="Not applicable"> Not applicable / No inspection yet</label>

        <p style="font-weight: bold;">12. Is there an ongoing development or government housing project in the area?</p>
        <label><input type="radio" name="ongoing_development"> Yes</label>
        <label><input type="radio" name="ongoing_development"> No</label>
        <label><input type="radio" name="ongoing_development" style="margin-bottom: 12px;"> Not sure</label>

        <!-- Section 2 -->
        <p class="section-label" style="color: black;">Please describe what happened briefly, including how you found out about the issue.</p>
        <textarea></textarea>

        <!-- Section 3 -->
        <div class="section-header">COMPLAINANT’S CONSENT AND DECLARATION</div>
        <div class="consent">
          By submitting this complaint form, I hereby consent to the collection and processing of my personal information as necessary to address the issues raised regarding the lot in question. I confirm that the information provided is accurate and complete to the best of my knowledge. I understand that any false or incomplete information may affect the handling of my complaint, and I acknowledge that my personal details will be processed in compliance with the Privacy Act and other applicable laws.
        </div>

        <div class="signature">
          <input type="file" id="signatureInput" accept="image/*" style="display:none;" />
          <button type="button" class="upload-btn" onclick="document.getElementById('signatureInput').click()">Upload Signature</button>
          <span id="signatureFileName" style="margin-left:10px;  font-style:italic;"></span>
        </div>
      </form>
    </div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', async () => {
  try {
    const res = await fetch('/complainant/pathway_dispute/get_pathway_session_data', { credentials: 'same-origin' });
    const contentType = res.headers.get('content-type') || '';
    if (!contentType.includes('application/json')) return;
    const d = await res.json();
    const container = document.getElementById('complainantDetails');
    if (!container || !d || d.error) return;

    // --- Helper functions ---
    function row1(label, value, type = 'text') {
      const r = document.createElement('div');
      r.className = 'pair-row';
      r.innerHTML = `<div class="col"><label class="small">${label}</label><input type="${type}" value="${value || ''}" readonly></div>`;
      return r;
    }

    function row2(l1, v1, l2, v2, t1='text', t2='text') {
      const r = document.createElement('div');
      r.className = 'pair-row';
      r.innerHTML = `
        <div class="col"><label class="small">${l1}</label><input type="${t1}" value="${v1 || ''}" readonly></div>
        <div class="col"><label class="small">${l2}</label><input type="${t2}" value="${v2 || ''}" readonly></div>`;
      return r;
    }

    function row3(l1, v1, l2, v2, l3, v3) {
      const r = document.createElement('div');
      r.className = 'pair-row';
      r.innerHTML = `
        <div class="col"><label class="small">${l1}</label><input type="text" value="${v1 || ''}" readonly></div>
        <div class="col"><label class="small">${l2}</label><input type="text" value="${v2 || ''}" readonly></div>
        <div class="col"><label class="small">${l3}</label><input type="text" value="${v3 || ''}" readonly></div>
      `;
      return r;
    }

    function normalizeName(name) {
      if (!name || typeof name !== 'string') return name || '';
      return name.replace(/\b([A-Z])\.*\b/g, '$1.');
    }

    function createSupportingDocsSection() {
      if ((d.category === 'hoa_member' || d.category === 'family_of_member') && d.supporting_documents) {
        const docDiv = document.createElement('div');
        docDiv.style.margin = '8px 0 16px 0';
        let labelText = 'What Supporting Documents do you have?';
        if (d.category === 'family_of_member') {
          labelText = 'What Supporting Documents does your Family Member have?';
        }
        docDiv.innerHTML = `<label style="font-weight:600; display:block; margin-bottom:2px;">${labelText}</label>`;

        const docList = [
          {key: 'title', label: 'Title'},
          {key: 'contract_to_sell', label: 'Contract to Sell'},
          {key: 'certificate_of_full_payment', label: 'Certificate of Full Payment'},
          {key: 'pre_qualification_stub', label: 'Pre-qualification Stub'},
          {key: 'contract_agreement', label: 'Contract/Agreement'},
          {key: 'deed_of_sale', label: 'Deed of Sale'}
        ];

        let selected = {};
        if (Array.isArray(d.supporting_documents)) {
          d.supporting_documents.forEach(k => selected[k] = true);
        } else if (typeof d.supporting_documents === 'object') {
          selected = d.supporting_documents;
        }

        let group = `<div class='checkbox-group' style="display:grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap:6px 16px;">`;
        docList.forEach(doc => {
          const checked = selected[doc.key] ? 'checked' : '';
          group += `<label style="white-space:nowrap;"><input type="checkbox" disabled ${checked}> ${doc.label}</label>`;
        });
        group += '</div>';
        docDiv.innerHTML += group;
        return docDiv;
      }
      return null;
    }

    // --- Render the complainant details ---
    const pairs = document.createElement('div');
    pairs.className = 'pairs';

    const cat = d.category;

    // --- Always show name, DOB, Sex, Citizenship, Age, Phone, Year of Residence ---
    pairs.appendChild(row1('Full Name:', normalizeName(d.full_name)));
    pairs.appendChild(row2('Date of Birth:', d.date_of_birth, 'Sex:', d.sex, 'date', 'text'));
    pairs.appendChild(row2('Citizenship:', d.citizenship, 'Age:', d.age));
    pairs.appendChild(row2('Phone Number:', d.phone_number, 'Year of Residence:', d.year_of_residence));

    if (cat === 'family_of_member') {
      pairs.appendChild(row2('Relationship:', d.relationship || '', 'Current Address:', d.cur_add));
      const docSection = createSupportingDocsSection();
      if (docSection) pairs.appendChild(docSection);
    } else if (cat === 'non_member' || cat === 'hoa_member') {
      pairs.appendChild(row3('Block Assignment:', d.blk_num || '', 'Lot Assignment:', d.lot_num || '', 'Lot Size:', d.lot_size || ''));
      pairs.appendChild(row2('Civil Status:', d.civil_status || '', 'Recipient of Other Housing:', d.recipient_of_other_housing || ''));
      pairs.appendChild(row1('Current Address:', d.cur_add));
      // Area (HOA) autofill fix: always use d.hoa, fallback to empty string
      let hoaValue = '';
      if (typeof d.hoa === 'string' && d.hoa.trim()) {
        hoaValue = d.hoa;
      } else if (typeof d.hoa === 'number') {
        hoaValue = String(d.hoa);
      }
      pairs.appendChild(row1('Area (HOA):', hoaValue, 'text'));
      const docSection = createSupportingDocsSection();
      if (docSection) pairs.appendChild(docSection);
    } else {
      pairs.appendChild(row1('Current Address:', d.cur_add));
    }

    container.innerHTML = '';
    container.appendChild(pairs);

  } catch (e) {
    console.error(e);
  }
});
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const form = document.getElementById('BoundaryDisputeForm');
  if (!form) return;

  // --- small CSS hint for disabled labels (visual cue) ---
  const style = document.createElement('style');
  style.textContent = `
    label.disabled { opacity: 0.6; }
    label.disabled input { cursor: not-allowed; }
  `;
  document.head.appendChild(style);
});
</script>
</body>
</html>